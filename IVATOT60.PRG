SET SCOREBOARD ON
SET BELL ON
SET CONFIRM OFF
SET DELETE ON
SET CENTURY ON
SET DATE BRITISH
SET EXCLUSIVE OFF
RESTORE FROM FISCAL.MEM
USE NUMEROS
STORE NOMBRE TO QNOM
STORE RTRIM(DOMICILIO) + " - " TO QDOM
QDOM = QDOM + RTRIM(LOCALIDAD)
STORE CUIT TO QCUIT
USE MOVIVA INDEX MIV_CLA1
STORE 83 TO JJ
DO WHILE JJ = 83
SET COLOR TO W/N
RESTORE SCREEN FROM PANT1
SET COLOR TO W+/RB
@ 2,6 SAY "                      CONSULTA TOTALES DE IVA"
SET COLOR TO W/B
@ 8,14 CLEAR TO 10,66
@ 7,14,11,66 BOX &caja9
@ 8,18 SAY "Desde Fecha(dd/mm/aaaa):"
@ 10,18 SAY "Hasta Fecha(dd/mm/aaaa):"
STORE CTOD("01/12/1998") TO DESDE
STORE CTOD("31/12/2020") TO HASTA
@ 8,44 GET DESDE
@ 10,44 GET HASTA
READ
IF LASTKEY() = 27
        CLOSE ALL
        RETURN
        JJ = 0
ENDIF
IF HASTA < DESDE
LOOP
ENDIF
STORE 1 TO VMENU
SET COLOR TO W+/RB
@ 23,14 PROMPT "CONTINUAR"
@ 23,37 PROMPT "CORREGIR"
@ 23,58 PROMPT "FINALIZAR"
MENU TO VMENU
IF VMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF VMENU = 2
LOOP
ENDIF
IF VMENU = 1
RESTORE SCREEN FROM PANT1
STORE 1 TO HOJA
SET COLOR TO N/BG
@ 2,5 SAY "Desde Fecha:"
@ 2,18 SAY DESDE
@ 2,40 SAY "Hasta Fecha:"
@ 2,53 SAY HASTA
STORE 6 TO LIN
SET COLOR TO W/B
STORE DESDE TO RDESDE
STORE 0 TO S1, S2, S3, S4, S5
STORE SPACE(8) TO BUSCAR 
SEEK BUSCAR
DO WHILE EOF()
BUSCAR = STR(YEAR(RDESDE),4) + STR(MONTH(RDESDE),2) + STR(DAY(RDESDE),2)
SEEK BUSCAR
RDESDE=RDESDE + 1
IF RDESDE > HASTA
EXIT
ENDIF
ENDDO
STORE 0 TO IVAFIN
STORE 0 TO IVAINS
STORE 0 TO TOTFIN
STORE 0 TO TOTINS
DO WHILE .NOT. EOF() .AND. FECHA <= HASTA
        IF CIVA="F" .OR. CIVA="M" .OR. CIVA = "E"
                TOTFIN=TOTFIN + NETO
                IVAFIN=IVAFIN + IVA 
            ELSE
                IF CIVA="I"
                        TOTINS = TOTINS + NETO
                        IVAINS = IVAINS + IVA
                ENDIF
        ENDIF
LIN = LIN + 1
SKIP
ENDDO
SET COLOR TO W+/B
@ 8,19 CLEAR TO 15,62
@ 7,19,16,62 BOX &caja9       &&dibuja una caja con los parametros de FISCAL.MEM
@9,21 SAY "Consumidores Finales"
@9,48 SAY IVAFIN
@11,21 SAY "Responsables Inscriptos"
@11,48 SAY IVAINS
@12,52 SAY "----------"
@14,21 SAY "Total ================>"
@14,48 SAY (IVAFIN+IVAINS)
SET COLOR TO W/R
STORE 1 TO PMENU
@ 23,10 PROMPT "OTRA CONSULTA"
@ 23,40 PROMPT "IMPRIMIR"
@ 23,60 PROMPT "FINALIZAR"
MENU TO PMENU
IF PMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF PMENU = 2
SET DEVICE TO PRINTER
@ 1,1 SAY CHR(27)+CHR(67)+CHR(72)
@ 2,1 SAY CHR(27)+CHR(77)+CHR(18)+QNOM 
@ 3,1 SAY "IVA Responsable Inscripto - C.U.I.T. " + QCUIT
//@ 4,1 SAY CHR(15)
@ 5,5 SAY CHR(14)+"TOTALES DE IVA - DEBITOS FISCALES"
STORE 1 TO HOJA
@ 7,1 SAY "Desde Fecha:"
@ 7,14 SAY DESDE
@ 7,30 SAY "Hasta Fecha:"
@ 7,43 SAY HASTA
@ 11,21 SAY "Consumidores Finales"
@ 11,58 SAY IVAFIN
@ 13,21 SAY "Responsables Inscriptos"
@ 13,58 SAY IVAINS
@ 14,57 SAY "----------"
@ 15,21 SAY "Total ================>"
@ 15,58 SAY (IVAFIN+IVAINS)

EJECT
SET DEVICE TO SCREEN
ENDIF
ENDIF
ENDDO
CLOSE ALL
RETURN
