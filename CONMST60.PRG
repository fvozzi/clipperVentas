SET SCOREBOARD ON
SET BELL ON
SET CONFIRM OFF
SET DELETE ON
SET DATE BRITISH
SET CENTURY ON
SET EXCLUSIVE OFF
RESTORE FROM FISCAL.MEM
DECLARE campos[2], tipom[8]
campos[1]="NUMERO"
campos[2]="NOMBRE"
tipom[1]="Compras"
tipom[2]="Dev.Ventas"
tipom[3]="Ot.Ingresos"
tipom[4]="Transf.Ing."
tipom[5]="Ventas"
tipom[6]="Dev.Compras"
tipom[7]="Ot.Egresos"
tipom[8]="Transf.Egr."
SELECT 1
USE ARTICULO INDEX ART_NUM, ART_NOM
SELECT 2
USE MSTOCK INDEX MST_CLA1
STORE 83 TO JJ
DO WHILE JJ = 83
SET COLOR TO W/N
RESTORE SCREEN FROM PANT1
SET COLOR TO W+/RB
@ 2,6 SAY "                CONSULTA DE MOVIMIENTOS DE PRODUCTOS"
SET COLOR TO W/B
@ 8,14 CLEAR TO 12,66
@ 7,14,13,66 BOX &caja9
@ 8,18 SAY "C¢digo Producto:"
@ 10,18 SAY "Desde Fecha(dd/mm/aaaa):"
@ 12,18 SAY "Hasta Fecha(dd/mm/aaaa):"
STORE SPACE(30) TO RCLI
STORE CTOD("01/01/2000") TO DESDE
STORE CTOD("31/12/2030") TO HASTA
@ 8,35 GET RCLI
READ

        
SAVE SCREEN TO MP1
SELECT 1
SET ORDER TO 2
SET EXACT OFF
SEEK RTRIM(RCLI)
IF EOF()
GO TOP
ENDIF
SET EXACT ON
KEYBOARD CHR(4)
SET COLOR TO W/R
@ 4,40 CLEAR TO 21,79
@ 4,41,21,79 BOX &caja9
DBEDIT(5,42,20,78,campos,"finc")
RESTORE SCREEN FROM MP1
SET COLOR TO W/B
@ 8,35 SAY SPACE(30)
IF LASTKEY() = 13
STORE NUMERO TO RCLI
ENDIF
IF LASTKEY() = 27
STORE SPACE(14) TO RCLI
@ 8,41 GET RCLI
READ
ENDIF
STORE " " TO GENERAL
IF ALLTRIM(RCLI) = "9999"
        RCLI = NUMERO
        STORE "9999" TO GENERAL
ENDIF

@ 8,41 SAY RCLI
@ 10,42 GET DESDE
@ 12,42 GET HASTA
READ
SET ORDER TO 1
SEEK RCLI
IF EOF()
LOOP
ENDIF
IF HASTA < DESDE 
LOOP
ENDIF
STORE 1 TO VMENU
SET COLOR TO W+/RB
@ 23,14 PROMPT "CONTINUAR"
@ 23,37 PROMPT "CORREGIR"
@ 23,58 PROMPT "FINALIZAR"
MENU TO VMENU
IF VMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF VMENU = 2
LOOP
ENDIF
IF VMENU = 1
RESTORE SCREEN FROM PANTMS
SET COLOR TO W/R
STORE 1 TO HOJA
@ 4,10 SAY RCLI
@ 4,25 SAY NOMBRE
@ 4,59 SAY "Pagina N§"
@ 4,69 SAY HOJA PICTURE "9999"
STORE 8 TO LIN
SET COLOR TO W/N
SELECT 2
GO TOP
STORE 0 TO SL, FL, SA
STORE RCLI TO BUSCAR 
SEEK BUSCAR
DO WHILE .NOT. EOF() .AND. PRODUCTO = RCLI
IF FECHA > HASTA
EXIT
ENDIF
IF FECHA < DESDE
STORE CANT TO R_IMP
IF TMOV < 5
SA = SA + R_IMP
ENDIF
IF TMOV > 4
SA = SA - R_IMP
ENDIF
ENDIF
IF FECHA <= HASTA
STORE CANT TO R_IMP
IF TMOV < 5
SL = SL + R_IMP
ENDIF
IF TMOV > 4
SL = SL - R_IMP
ENDIF
IF FECHA >= DESDE .AND. FECHA <= HASTA
IF FL = 0
IF SA <> 0
@ LIN,16 SAY "SALDO ANTERIOR"
@ LIN,68 SAY SA PICTURE "###,###"
LIN = LIN + 1
ENDIF
STORE 1 TO FL
ENDIF
IF R_IMP <> 0
@ LIN,5 SAY FECHA
@ LIN,16 SAY CBTE
@ LIN,37 SAY TMOV PICTURE "##"
@ LIN,40 SAY tipom[TMOV]
IF TMOV < 5
@ LIN,52 SAY R_IMP PICTURE "###,###"
ENDIF
IF TMOV > 4
@ LIN,60 SAY R_IMP PICTURE "###,###"
ENDIF
@ LIN,68 SAY SL PICTURE "###,###"
LIN = LIN + 1
IF LIN = 20
SET COLOR TO W/B
STORE " " TO HH
@ 23,2 SAY "PARA CONTINUAR DIGITE TECLA <=ENTER=> " GET HH
READ
RESTORE SCREEN FROM PANTMS
SET COLOR TO W/R
HOJA = HOJA + 1
SELECT 1
@ 4,10 SAY RCLI
@ 4,25 SAY NOMBRE
@ 4,59 SAY "Pagina N§"
@ 4,69 SAY HOJA PICTURE "9999"
STORE 8 TO LIN
SET COLOR TO W/N
SELECT 2
ENDIF
ENDIF
ENDIF
ENDIF
SKIP
//*******ESTO ES UNA NUEVA LINEA DE CODIGO ******
IF GENERAL = "9999"
        RCLI = PRODUCTO
ENDIF
ENDDO
SET COLOR TO W/B
STORE 1 TO PMENU
@ 23,13 PROMPT "OTRA CONSULTA"
@ 23,38 PROMPT "IMPRIMIR"
@ 23,58 PROMPT "FINALIZAR"
MENU TO PMENU
IF PMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF PMENU = 2
SELECT 1
SET DEVICE TO PRINTER
@ 1,1 SAY CHR(27)+CHR(67)+CHR(72)
@ 2,1 SAY CHR(18)
@ 3,17 SAY CHR(14)+"MOVIMIENTOS DE PRODUCTOS"
STORE 1 TO HOJA
@ 5,1 SAY "Codigo: "+RCLI
@ 5,25 SAY "Nombre:"
@ 5,33 SAY NOMBRE
@ 5,67 SAY "Pagina N§"
@ 5,77 SAY HOJA PICTURE "9999"
@ 6,1 SAY REPLICATE("-",80)
@ 7,9 SAY "FECHA"
@ 7,21 SAY "REFERENCIA"
@ 7,37 SAY "CM"
@ 7,40 SAY "TIPO MOVIM."
@ 7,52 SAY "ENTRADA"
@ 7,61 SAY "SALIDA"
@ 7,69 SAY "SALDO"
@ 8,1 SAY REPLICATE("-",80)
STORE 9 TO LIN
SELECT 2
GO TOP
STORE 0 TO SL, FL, SA
STORE RCLI TO BUSCAR 
SEEK BUSCAR
DO WHILE .NOT. EOF() .AND. PRODUCTO  = RCLI
IF FECHA > HASTA
EXIT
ENDIF
IF FECHA < DESDE
STORE CANT TO R_IMP
IF TMOV < 5
SA = SA + R_IMP
ENDIF
IF TMOV > 4
SA = SA - R_IMP
ENDIF
ENDIF
IF FECHA <= HASTA
STORE CANT TO R_IMP
IF TMOV < 5
SL = SL + R_IMP
ENDIF
IF TMOV > 4
SL = SL - R_IMP
ENDIF
IF FECHA >= DESDE .AND. FECHA <= HASTA
IF FL = 0
IF SA <> 0
@ LIN,37 SAY "SALDO ANTERIOR"
@ LIN,68 SAY SA PICTURE "###,###"
LIN = LIN + 1
ENDIF
STORE 1 TO FL
ENDIF
IF R_IMP <> 0
@ LIN,5 SAY FECHA
@ LIN,16 SAY CBTE
@ LIN,37 SAY TMOV 
@ LIN,40 SAY tipom[TMOV]
IF TMOV < 5
@ LIN,52 SAY R_IMP PICTURE "###,###"
ENDIF
IF TMOV > 4
@ LIN,60 SAY R_IMP PICTURE "###,###"
ENDIF
@ LIN,68 SAY SL PICTURE "###,###"
LIN = LIN + 1
IF LIN = 68
SELECT 1
@ 2,1 SAY CHR(18)
@ 3,17 SAY CHR(14)+"MOVIMIENTOS DE PRODUCTOS"
STORE 1 TO HOJA
@ 5,1 SAY "Codigo: "+RCLI
@ 5,25 SAY "Nombre:"
@ 5,33 SAY NOMBRE
@ 5,67 SAY "Pagina N§"
@ 5,77 SAY HOJA PICTURE "9999"
@ 6,1 SAY REPLICATE("-",80)
@ 7,9 SAY "FECHA"
@ 7,21 SAY "REFERENCIA"
@ 7,37 SAY "CM"
@ 7,40 SAY "TIPO MOVIM."
@ 7,52 SAY "ENTRADA"
@ 7,61 SAY "SALIDA"
@ 7,69 SAY "SALDO"
@ 8,1 SAY REPLICATE("-",80)
STORE 9 TO LIN
SELECT 2
ENDIF
ENDIF
ENDIF
ENDIF
SKIP
ENDDO
EJECT
SET DEVICE TO SCREEN
ENDIF
ENDIF
ENDDO
CLOSE ALL
RETURN

