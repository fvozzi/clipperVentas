SET SCOREBOARD ON
SET BELL ON
SET CONFIRM OFF
SET DELETE ON
SET CENTURY ON
SET DATE BRITISH
SET EXCLUSIVE OFF
RESTORE FROM FISCAL.MEM
USE NUMEROS
STORE NOMBRE TO QNOM
STORE RTRIM(DOMICILIO) + " - " TO QDOM
QDOM = QDOM + RTRIM(LOCALIDAD)
STORE CUIT TO QCUIT
USE MOVIVA INDEX MIV_CLA1
STORE 83 TO JJ
DO WHILE JJ = 83
SET COLOR TO W/N
RESTORE SCREEN FROM PANT1
SET COLOR TO W+/RB
@ 2,6 SAY "                      CONSULTA SUBDIARIO DE IVA"
SET COLOR TO W/B
@ 8,14 CLEAR TO 10,66
@ 7,14,11,66 BOX &caja9
@ 8,18 SAY "Desde Fecha(dd/mm/aaaa):"
@ 10,18 SAY "Hasta Fecha(dd/mm/aaaa):"
STORE CTOD("01/12/1998") TO DESDE
STORE CTOD("31/12/2030") TO HASTA
@ 8,44 GET DESDE
@ 10,44 GET HASTA
READ
IF LASTKEY() = 27
        RETURN
        JJ = 0
ENDIF
IF HASTA < DESDE
LOOP
ENDIF
STORE 1 TO VMENU
SET COLOR TO W+/RB
@ 23,14 PROMPT "CONTINUAR"
@ 23,37 PROMPT "CORREGIR"
@ 23,58 PROMPT "FINALIZAR"
MENU TO VMENU
IF VMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF VMENU = 2
LOOP
ENDIF
IF VMENU = 1
RESTORE SCREEN FROM PANTIVA
STORE 1 TO HOJA
SET COLOR TO N/BG
@ 2,0 SAY "Desde Fecha:"
@ 2,13 SAY DESDE
@ 2,24 SAY "Hasta Fecha:"
@ 2,37 SAY HASTA
@ 2,66 SAY "Pagina N§"
@ 2,76 SAY HOJA PICTURE "9999"
STORE 6 TO LIN
SET COLOR TO W/B
STORE DESDE TO RDESDE
STORE 0 TO S1, S2, S3, S4, S5
STORE SPACE(8) TO BUSCAR 
SEEK BUSCAR
DO WHILE EOF()
BUSCAR = STR(YEAR(RDESDE),4) + STR(MONTH(RDESDE),2) + STR(DAY(RDESDE),2)
SEEK BUSCAR
RDESDE=RDESDE + 1
IF RDESDE > HASTA
EXIT
ENDIF
ENDDO
DO WHILE .NOT. EOF() .AND. FECHA <= HASTA
SET CENTURY OFF
@ LIN,1 SAY FECHA
SET CENTURY ON
@ LIN,10 SAY CBTE
@ LIN,31 SAY EXENTO PICTURE "#####.##"
@ LIN,40 SAY ALIC PICTURE "##"
@ LIN,43 SAY GRAVADO PICTURE "#####.##"
@ LIN,52 SAY IVA PICTURE "#####.##"
@ LIN,61 SAY IVANO PICTURE "#####.##"
@ LIN,70 SAY NETO PICTURE "######.##"
S1 = S1 + EXENTO
S2 = S2 + GRAVADO
S3 = S3 + IVA
S4 = S4 + IVANO
S5 = S5 + NETO
@ 23,31 SAY S1 PICTURE "#####.##"
@ 23,43 SAY S2 PICTURE "#####.##"
@ 23,52 SAY S3 PICTURE "#####.##"
@ 23,61 SAY S4 PICTURE "#####.##"
@ 23,70 SAY S5 PICTURE "######.##"
LIN = LIN + 1
IF LIN = 22
SET COLOR TO W/R
STORE " " TO HH
@ 24,0 SAY "PARA CONTINUAR DIGITE TECLA <=ENTER=> " GET HH
READ
RESTORE SCREEN FROM PANTIVA
HOJA=HOJA + 1
SET COLOR TO N/BG
@ 2,0 SAY "Desde Fecha:"
@ 2,13 SAY DESDE
@ 2,24 SAY "Hasta Fecha:"
@ 2,37 SAY HASTA
@ 2,66 SAY "Pagina N§"
@ 2,76 SAY HOJA PICTURE "9999"
STORE 6 TO LIN
SET COLOR TO W/B
ENDIF
SKIP
ENDDO
SET COLOR TO W/R
STORE 1 TO PMENU
@ 24,6 PROMPT "OTRA CONSULTA"
@ 24,25 PROMPT "IMPRIMIR"
@ 24,39 PROMPT "FINALIZAR"
MENU TO PMENU
IF PMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF PMENU = 2
SET DEVICE TO PRINTER
@ 2,1 SAY QNOM 
@ 3,1 SAY "IVA Responsable Inscripto - C.U.I.T. " + QCUIT
@ 5,44 SAY "SUBDIARIO DE IVA - DEBITOS FISCALES"
STORE 1 TO HOJA
@ 7,1 SAY "Desde Fecha:"
@ 7,14 SAY DESDE
@ 7,25 SAY "Hasta Fecha:"
@ 7,38 SAY HASTA
@ 7,141 SAY "Pagina N§"
@ 7,151 SAY HOJA PICTURE "9999"
@ 8,1 SAY REPLICATE("-",154)
@ 9,3 SAY "FECHA"
@ 9,17 SAY "APELLIDO Y NOMBRE"
@ 9,42 SAY "CONDICION IVA"
@ 9,58 SAY "C.U.I.T."
@ 9,75 SAY "REFERENCIA"
@ 9,91 SAY "AL"
@ 9,95 SAY "IMP.EXENTO"
@ 9,106 SAY "IMP.GRAVADO"
@ 9,118 SAY "IMPORTE IVA"
@ 9,130 SAY "RET.NO INSC"
@ 9,143 SAY "IMP.TOTAL"
@ 10,1 SAY REPLICATE("-",154)
STORE 11 TO LIN
STORE DESDE TO RDESDE
STORE 0 TO S1, S2, S3, S4, S5
STORE SPACE(8) TO BUSCAR 
SEEK BUSCAR
DO WHILE EOF()
BUSCAR = STR(YEAR(RDESDE),4) + STR(MONTH(RDESDE),2) + STR(DAY(RDESDE),2)
SEEK BUSCAR
RDESDE=RDESDE + 1
ENDDO
SEEK BUSCAR
DO WHILE .NOT. EOF() .AND. FECHA <= HASTA
SET CENTURY OFF
@ LIN,1 SAY FECHA
SET CENTURY ON
@ LIN,11 SAY NOMBRE
IF CIVA = "I"
@ LIN,42 SAY "Resp.Inscrip."
ENDIF
IF CIVA = "N"
@ LIN,42 SAY "Resp.No Insc."
ENDIF
IF CIVA = "F"
@ LIN,42 SAY "Cons.Final   "
ENDIF
IF CIVA = "E"
@ LIN,42 SAY "Exento       " 
ENDIF
IF CIVA = "R"
@ LIN,42 SAY "No Responsab."
ENDIF
@ LIN,56 SAY CUIT
@ LIN,70 SAY CBTE
@ LIN,91 SAY ALIC PICTURE "##"
@ LIN,94 SAY EXENTO PICTURE "########.##"
@ LIN,106 SAY GRAVADO PICTURE "########.##"
@ LIN,118 SAY IVA PICTURE "########.##"
@ LIN,130 SAY IVANO PICTURE "########.##"
@ LIN,142 SAY NETO PICTURE "########.##"
S1 = S1 + EXENTO
S2 = S2 + GRAVADO
S3 = S3 + IVA
S4 = S4 + IVANO
S5 = S5 + NETO
LIN = LIN + 1
IF LIN = 42
@ 2,1 SAY QNOM 
@ 3,1 SAY "IVA Responsable Inscripto - C.U.I.T. " + QCUIT
@ 5,44 SAY "SUBDIARIO DE IVA - DEBITOS FISCALES"
HOJA = HOJA + 1
@ 7,1 SAY "Desde Fecha:"
@ 7,14 SAY DESDE
@ 7,23 SAY "Hasta Fecha:"
@ 7,36 SAY HASTA
@ 7,141 SAY "Pagina N§"
@ 7,151 SAY HOJA PICTURE "9999"
@ 8,1 SAY REPLICATE("-",154)
@ 9,3 SAY "FECHA"
@ 9,17 SAY "APELLIDO Y NOMBRE"
@ 9,42 SAY "CONDICION IVA"
@ 9,58 SAY "C.U.I.T."
@ 9,75 SAY "REFERENCIA"
@ 9,91 SAY "AL"
@ 9,95 SAY "IMP.EXENTO"
@ 9,106 SAY "IMP.GRAVADO"
@ 9,118 SAY "IMPORTE IVA"
@ 9,130 SAY "RET.NO INSC"
@ 9,143 SAY "IMP.TOTAL"
@ 10,1 SAY REPLICATE("-",154)
STORE 11 TO LIN
ENDIF
SKIP
ENDDO
@ LIN,1 SAY REPLICATE("-",154)
@ LIN+1,1 SAY "TOTALES"
@ LIN+1,94 SAY S1 PICTURE "########.##"
@ LIN+1,106 SAY S2 PICTURE "########.##"
@ LIN+1,118 SAY S3 PICTURE "########.##"
@ LIN+1,130 SAY S4 PICTURE "########.##"
@ LIN+1,142 SAY S5 PICTURE "########.##"
@ LIN+2,1 SAY REPLICATE("=",154)
EJECT
SET DEVICE TO SCREEN
ENDIF
ENDIF
ENDDO
CLOSE ALL
RETURN
