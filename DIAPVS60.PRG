SET SCOREBOARD ON
SET BELL ON
SET CONFIRM OFF
SET DELETE ON
SET CENTURY ON
SET DATE BRITISH
SET EXCLUSIVE OFF
RESTORE FROM FISCAL.MEM
SELECT 1
USE PROVEEDO INDEX DEU_NUM, DEU_NOM
SELECT 2
USE MPROVEED INDEX MCC_CLA2
SELECT 3
USE NUMEROS
GO 1
STORE NOMBRE TO ENOM
STORE DOMICILIO TO EDOM
STORE LOCALIDAD TO ELOC
STORE 83 TO JJ
DO WHILE JJ = 83
RESTORE SCREEN FROM PANT1
SET COLOR TO W+/RB
@ 2,6 SAY "            CONSULTA SUBDIARIO DE CUENTAS DE PROVEEDORES"
SET COLOR TO W/B
@ 8,14 CLEAR TO 10,66
@ 7,14,11,66 BOX &caja9
@ 8,18 SAY "Desde Fecha(dd/mm/aaaa):"
@ 10,18 SAY "Hasta Fecha(dd/mm/aaaa):"
STORE CTOD("01/01/1998") TO DESDE
STORE CTOD("31/12/2020") TO HASTA
@ 8,43 GET DESDE
@ 10,43 GET HASTA
READ
IF LASTKEY() = 27
        CLOSE ALL
        RETURN
        JJ = 0
ENDIF
IF HASTA < DESDE
LOOP
ENDIF
SET COLOR TO W+/RB
STORE 1 TO VMENU
@ 23,14 PROMPT "CONTINUAR"
@ 23,37 PROMPT "CORREGIR"
@ 23,58 PROMPT "FINALIZAR"
MENU TO VMENU
IF VMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF VMENU = 2
LOOP
ENDIF
IF VMENU = 1
RESTORE SCREEN FROM PANTDCC
STORE 1 TO HOJA
SET COLOR TO N/BG
@ 2,0 SAY "Desde Fecha:"
@ 2,13 SAY DESDE
@ 2,24 SAY "Hasta Fecha:"
@ 2,37 SAY HASTA
@ 2,66 SAY "Pagina N§"
@ 2,76 SAY HOJA PICTURE "9999"
STORE 6 TO LIN
SELECT 2
STORE DESDE TO RDESDE
STORE 0 TO SL, FL
STORE SPACE(8) TO BUSCAR 
SEEK BUSCAR
DO WHILE EOF()
BUSCAR = STR(YEAR(RDESDE),4) + STR(MONTH(RDESDE),2) + STR(DAY(RDESDE),2)
SEEK BUSCAR
RDESDE=RDESDE + 1
IF RDESDE > HASTA
EXIT
ENDIF
ENDDO
DO WHILE .NOT. EOF() .AND. FECHA <= HASTA
        SET COLOR TO W/B
        STORE VALOR TO R_IMP
        IF R_IMP <> 0 
                STORE NUMERO TO BUSCO
                SELECT 1
                SEEK BUSCO
                @ LIN,1 SAY LEFT(NOMBRE,24)
                SELECT 2
                @ LIN,26 SAY FECHA
                @ LIN,37 SAY CBTE
                IF TMOV = 1
                        @ LIN,58 SAY R_IMP PICTURE "###,###.##"
                        SL = SL + R_IMP
                ENDIF
                IF TMOV = 2 .OR. TMOV = 7
                        @ LIN,69 SAY R_IMP PICTURE "###,###.##"
                        FL = FL + R_IMP
                ENDIF
                @ 23,58 SAY SL PICTURE "###,###.##"
                @ 23,69 SAY FL PICTURE "###,###.##"
                LIN = LIN + 1
                IF LIN = 22
                        SET COLOR TO W/R
                        STORE " " TO HH
                        @ 23,0 SAY "PARA CONTINUAR DIGITE TECLA <=ENTER=> " GET HH
                        READ
                        RESTORE SCREEN FROM PANTDCC
                        HOJA=HOJA + 1
                        SET COLOR TO N/BG
                        @ 2,0 SAY "Desde Fecha:"
                        @ 2,13 SAY DESDE
                        @ 2,24 SAY "Hasta Fecha:"
                        @ 2,37 SAY HASTA
                        @ 2,66 SAY "Pagina N§"
                        @ 2,76 SAY HOJA PICTURE "9999"
                        STORE 6 TO LIN
                ENDIF
        ENDIF
        SELECT 2
        SKIP
ENDDO
SET COLOR TO W/R
STORE 1 TO PMENU
@ 24,6 PROMPT "OTRA CONSULTA"
@ 24,25 PROMPT "IMPRIMIR"
@ 24,39 PROMPT "FINALIZAR"
MENU TO PMENU
IF PMENU = 3
STORE 84 TO JJ
EXIT
ENDIF
IF PMENU = 2
SET DEVICE TO PRINTER
@ 1,1 SAY CHR(27)+CHR(67)+CHR(72)+CHR(27)+CHR(77)+CHR(18)+CHR(14)+ENOM
@ 2,1 SAY EDOM
@ 3,1 SAY ELOC
@ 5,17 SAY CHR(14)+"SUBDIARIO DE CUENTAS CORRIENTES"
STORE 1 TO HOJA
@ 7,1 SAY "Desde Fecha:"
@ 7,14 SAY DESDE
@ 7,26 SAY "Hasta Fecha:"
@ 7,39 SAY HASTA
@ 7,81 SAY "Pagina N§"
@ 7,91 SAY HOJA PICTURE "9999"
@ 8,1 SAY REPLICATE("-",94)
@ 9,1 SAY "CUENTA"
@ 9,14 SAY "APELLIDO Y NOMBRE"
@ 9,42 SAY "FECHA"
@ 9,55 SAY "REFERENCIA"
@ 9,73 SAY "DEBITOS"
@ 9,83 SAY "CREDITOS"
@ 10,1 SAY REPLICATE("-",94)
STORE 11 TO LIN
SELECT 2
STORE DESDE TO RDESDE
STORE 0 TO SL, FL
STORE SPACE(8) TO BUSCAR 
SEEK BUSCAR
DO WHILE EOF()
BUSCAR = STR(YEAR(RDESDE),4) + STR(MONTH(RDESDE),2) + STR(DAY(RDESDE),2)
SEEK BUSCAR
RDESDE=RDESDE + 1
ENDDO
DO WHILE .NOT. EOF() .AND. FECHA <= HASTA
STORE VALOR TO R_IMP
IF R_IMP <> 0
@ LIN,1 SAY NUMERO
STORE NUMERO TO BUSCO
SELECT 1
SEEK BUSCO
@ LIN,8 SAY NOMBRE
SELECT 2
@ LIN,39 SAY FECHA
@ LIN,50 SAY CBTE
IF TMOV = 1
@ LIN,71 SAY R_IMP PICTURE "###,###.##"
SL = SL + R_IMP
ENDIF
IF TMOV = 2 .OR. TMOV = 7
@ LIN,82 SAY R_IMP PICTURE "###,###.##"
FL = FL + R_IMP
ENDIF
LIN = LIN + 1
IF LIN = 68
@ 1,1 SAY ENOM
@ 2,1 SAY EDOM
@ 3,1 SAY ELOC
@ 5,16 SAY CHR(14)+"SUBDIARIO DE CUENTAS DE PROVEEDORES"
HOJA=HOJA + 1
@ 7,1 SAY "Desde Fecha:"
@ 7,14 SAY DESDE
@ 7,23 SAY "Hasta Fecha:"
@ 7,36 SAY HASTA
@ 7,81 SAY "Pagina N§"
@ 7,91 SAY HOJA PICTURE "9999"
@ 8,1 SAY REPLICATE("-",94)
@ 9,1 SAY "CUENTA"
@ 9,14 SAY "APELLIDO Y NOMBRE"
@ 9,42 SAY "FECHA"
@ 9,55 SAY "REFERENCIA"
@ 9,73 SAY "DEBITOS"
@ 9,83 SAY "CREDITOS"
@ 10,1 SAY REPLICATE("-",94)
STORE 11 TO LIN
ENDIF
ENDIF
SKIP
ENDDO
@ LIN,1 SAY REPLICATE("-",94)
@ LIN+1,1 SAY "TOTALES"
@ LIN+1,67 SAY SL PICTURE "##,###,###.##"
@ LIN+1,81 SAY FL PICTURE "##,###,###.##"
@ LIN+2,1 SAY REPLICATE("=",94)
@ LIN+3,1 SAY CHR(27)+CHR(80)
EJECT
SET DEVICE TO SCREEN
ENDIF
ENDIF
ENDDO
CLOSE ALL
RETURN
