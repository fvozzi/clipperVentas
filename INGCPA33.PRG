SET SCOREBOARD ON
SET BELL ON
SET CONFIRM OFF
SET DELETE OFF
SET CENTURY ON
SET EXCLUSIVE OFF
SET DATE BRITISH
RESTORE FROM FISCAL.MEM
DECLARE campos[2]
campos[1]="NUMERO"
campos[2]="NOMBRE"
SELECT 1
USE ARTICULO INDEX ART_NUM, ART_NOM
SELECT 6
USE MSTOCK INDEX MST_CLA1, MST_CLA2
SELECT 7
USE RSTOCK INDEX RST_CLA1
SELECT 8
USE NUMEROS
GO 1
STORE DATE() TO RFECHA
RESTORE SCREEN FROM PANT1
SET COLOR TO W/B
@ 11,19,15,62 BOX &caja9
@ 13,22 SAY "FECHA:"
@ 13,29 SAY RFECHA
@ 13,29 GET RFECHA
READ
STORE 83 TO JJ
DO WHILE JJ = 83
RESTORE SCREEN FROM PANT1
SET COLOR TO W+/RB
@ 2,6 SAY "INGRESO DE COMPRAS DE PRODUCTOS                     Fecha:"
@ 2,65 SAY RFECHA
@ 23,2 SAY "FINALIZAR: TECLA <=ESC=>"
@ 23,55 SAY "CONSULTA: TECLA <=PgUp=>"
SET COLOR TO W/B
@ 8,7 CLEAR TO 16,60
@ 7,7,17,60 BOX &caja9
@ 8,8 SAY "Producto:"
@ 10,8 SAY "Nombre:"
@ 12,8 SAY "Cantidad:"
@ 14,8 SAY "Importe sin IVA:"
@ 16,8 SAY "Comprobante:"
**************************************************************************
SELECT 1
STORE SPACE(14) TO RLIN
SEEK RLIN
DO WHILE EOF()
STORE SPACE(14) TO RLIN
@ 8,20 GET RLIN
READ
IF LASTKEY() = 27
EXIT
ENDIF
IF LASTKEY() = 18
campos[1]="NUMERO"
SAVE SCREEN TO MP1
STORE SPACE(30) TO BUSCO
@ 8,23 GET BUSCO
READ
SET ORDER TO 2
SEEK RTRIM(BUSCO)
IF EOF()
GO TOP
ENDIF
KEYBOARD CHR(4)
SET COLOR TO W/R
@ 4,40 CLEAR TO 21,70
@ 4,40,21,71 BOX &caja9
DBEDIT(5,41,20,70,campos,"finc")
RESTORE SCREEN FROM MP1
SET COLOR TO W/B
IF LASTKEY() = 13
        STORE NUMERO TO RLIN
ENDIF
IF LASTKEY() = 27
        STORE SPACE(14) TO RLIN
ENDIF
ENDIF
SET ORDER TO 1
SEEK RLIN
ENDDO
IF LASTKEY() = 27 
        EXIT
ENDIF
@ 8,20 SAY NUMERO
@ 10,20 SAY NOMBRE
@ 14,25 SAY PRECIO
STORE PRECIO TO RVALOR
STORE 0 TO RCANT  //, RVALOR
STORE SPACE(20) TO RCBTE
@ 12,20 GET RCANT PICTURE "####.##" RANGE 0.01,9999.99
@ 14,25 GET RVALOR PICTURE "###,###.##"
@ 16,21 GET RCBTE
READ
@ 14,25 SAY RVALOR PICTURE "###,###.##"
@ 16,21 SAY RCBTE
STORE 1 TO RMENU
SET COLOR TO W+/RB
@ 23,2 CLEAR TO 23,78
@ 23,23 PROMPT "CONFIRMAR"
@ 23,52 PROMPT "ANULAR"
MENU TO RMENU
  DO CASE
     CASE RMENU = 1
     SET COLOR TO W/B
     STORE SPACE(14) TO RCODIGO
     RCODIGO = RLIN 
     SELECT 7
     SEEK RCODIGO
     IF .NOT. EOF()
     RLOCK()
     REPLACE UN_TRANSFI WITH UN_TRANSFI + RCANT, EX_FISICA WITH EX_FISICA + RCANT
     UNLOCK
     ENDIF
     IF EOF()
     RLOCK()
     APPEND BLANK
     REPLACE PRODUCTO WITH RCODIGO, UN_TRANSFI WITH RCANT, UN_TRANSFE WITH 0, UN_VEND WITH 0, EX_FISICA WITH RCANT, VAL_VENTA WITH 0, FU_VENTA WITH CTOD("  /  /  ")
     UNLOCK
     ENDIF
     SELECT 6
     RLOCK()
     APPEND BLANK
     REPLACE PRODUCTO WITH RCODIGO, FECHA WITH RFECHA, TMOV WITH 1, CBTE WITH RCBTE, CANT WITH RCANT, VALOR WITH RVALOR
     REPLACE CONIVA WITH RVALOR * 1.21, CLIENTE WITH 0, PLISTA WITH 0, PVENTA WITH 0
     UNLOCK
     CASE RMENU=2
     STORE " " TO HH
     SET COLOR TO W+/RB
     @ 23,2 CLEAR TO 23,78
     @ 23, 2 SAY "ESTE MOVIMIENTO NO SE ACTUALIZO " GET HH
     READ
   ENDCASE
ENDDO
CLOSE ALL
RETURN

